#:import get_color utils.theme.get_color
#:import dp kivy.metrics.dp

<TransactionItem>:
    size_hint_y: None
    height: dp(75) # Increased height to accommodate tag
    padding: dp(10)
    spacing: dp(10)
    canvas.before:
        Color:
            rgba: get_color(app.theme, "list_item_bg")
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(5)]

    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.85
        spacing: dp(2)

        BoxLayout: # Top row: Description and Amount
            Label:
                text: root.description
                font_size: '16sp'
                halign: 'left'
                valign: 'middle'
                text_size: self.width, None
                shorten: True
                shorten_from: 'right'
                size_hint_x: 0.7
                color: get_color(app.theme, "text_color")
            Label:
                text: f"{root.amount} {root.currency}"
                font_size: '16sp'
                halign: 'right'
                valign: 'middle'
                text_size: self.width, None
                size_hint_x: 0.3
                color: (0.1, 0.7, 0.1, 1) if root.transaction_type == 'Credit' else (0.9, 0.1, 0.1, 1)
                bold: True

        BoxLayout: # Middle row: Type and Date
            Label:
                text: root.transaction_type
                font_size: '12sp'
                halign: 'left'
                valign: 'middle'
                text_size: self.width, None
                size_hint_x: 0.5
                color: get_color(app.theme, "text_color")[:3] + [0.7]
            Label:
                text: root.date.split(' ')[0] if ' ' in root.date else root.date
                font_size: '12sp'
                halign: 'right'
                valign: 'middle'
                text_size: self.width, None
                size_hint_x: 0.5
                color: get_color(app.theme, "text_color")[:3] + [0.7]

        Label: # Bottom row: Tag
            text: f"Tag: {root.tag}" if root.tag else "Tag: Uncategorized"
            font_size: '11sp' # Smaller font for tag
            halign: 'left'
            valign: 'middle'
            text_size: self.width, None
            color: get_color(app.theme, "secondary_text") # Use secondary text color
            italic: True

    Button:
        id: delete_button
        size_hint_x: 0.15
        background_color: [0,0,0,0]
        background_normal: ""
        background_down: "assets/delete_icon_pressed.png" if root.delete_callback else ""
        on_press: root.trigger_delete()
        disabled: not root.delete_callback
        Image:
            source: "assets/delete_icon.png"
            center_x: self.parent.center_x
            center_y: self.parent.center_y
            size_hint: None, None
            size: dp(24), dp(24)
            allow_stretch: True
            keep_ratio: True
            color: get_color(app.theme, "error_color")